## 数据链路层

将网络层传来的IP数据报封装成帧，差错控制，流量控制，介质访问控制



### **数据链路层的作用**

**封装成帧**

帧定界：确定帧的界限

帧同步：接收方能区分帧的起始和终止

透明传输：不管什么样的比特组合，都能在链路上传输

方法：字符计数法，字节填充法，0比特填充法，违规编码法

**差错控制**

奇偶校验码，循环冗余码CRC，海明码

**流量控制**

限制发送方发送速率不超过接收方的接收能力。

数据链路层：点对点，接收方接受不下就不回复确认。

传输层：端对端，接收端发给发送端一个窗口公告。

流量控制的方法：停止等待协议，滑动窗口协议（后退N帧协议，选择重传协议）





### **可靠传输的方式**

**ARQ自动重传请求协议：**分为连续ARQ和停止等待ARQ，接收方根据检错码对发送方的数据帧进行错误检测，发现错误则丢弃，发送方超时则重传该数据帧。



**停止等待协议：**发送方每发送一个帧，必须收到接收方确认帧才能发送下一个帧，如果在规定未收到确认帧，则发送方超时，重传该帧

 

**GBN后退N帧协议：**发送方可以发送若干连续的数据帧，接收方对帧采用**累计确认**，**按序接收**的方式，接收方对于不按序接收的帧及错误的帧直接丢弃，若发送方已接收到n号帧的确认，表明n号帧及之前的帧都已正确接收，滑动窗口，如果出现超时的帧，发送发需要重新发送所有为被确认的帧。

发送窗口大小为1~2^n-1^，否则接收方无法区分新帧和旧帧

 

**SR选择重传协议：**发送发可以发送若干个连续的帧，接受方可以**缓存正确按不按序的帧**，发送方只需重传出现错误或超时的帧，直到接收方一个窗口内所有的帧的正确接收再交付给上层，然后滑动窗口。

接收窗口为最大时，发送窗口大小为2^(n-1)^，接受窗口大小为2^(n-1)^







**LLC逻辑链路控制子层：**

识别网络层协议，对他们进行封装，编号，提供与网络层的接口

向网络层提供无确认的无连接服务，有确认的无连接服务，有确认的面向连接服务

**MAC介质访问控制子层：**

负责连接和控制物理层的物理介质，组帧，差错控制，透明传输，使信道上结点间的通信不会互相干扰

三种实现方式：信道划分，随机访问，轮询访问



### **信道划分的方式**

#### **静态划分**

把多个输入通道的信息整合到一个复用通道中，在接收端把信息分离并传送到对应的输出通道

FDM频分多路复用：将物理信道按照频率划分为多个子信道，每个子信道传输一种信号

TDM 时分多路复用：将物理信道按时间分成若干时间片，轮流地分配给多个信号使用

STDM统计时分复用：TDM的改进，按需动态分配时间片，以此提高线路利用率

WDM波分多路复用：光的频分多路复用，一根光纤传输波长不同的光信号

CDM码分多路复用：采用不同的编码来区分各路原始信号，既共享频率又共享时间



#### **随机访问**

所有的用户能根据自己的意愿随机发送信息，占用信道全部带宽

核心思想：争用

随机访问介质访问控制协议又称争用型协议

 

**ALOHA：**不检测直接发送，没收到确认（认为发生冲突）则随即等待一段时间再发

**时隙ALOHA：**不检测直接发送，没收到确认则必须等到下一个时间片开始时刻再发

 

**CSMA （载波侦听多路访问）：**

载波侦听：在发送数据之前要检查信道是否发生冲突，根据信道忙或空闲做出不同反应

多路访问：多台主机以多点接入方式连接在一根总线上。

分类：

1-坚持CSMA：闲则发送，忙则继续监听

非坚持CSMA：闲则发送，忙则等待一个随机时间重新监听

p-坚持CSMA：闲则以概率p发送数据，1-p概率等待到下一个时间片再发送，忙则等待一个随机时间重新监听

 

 

**CSMA/CD（载波侦听多路访问/碰撞检测）**：

以太网所使用的随机的随机争用型介质访问控制方法，发送帧前先监听信道，信道空闲则发送数据，并在发送数据的同时边发送边检测信道是否有冲突，有则停止发送，随机等待一段时间再发送

主要用于有线局域网

CSMA的改进，适用于总线型网络和半双工通信

争用期（冲突窗口或碰撞窗口）：2*单程传播时延，如果在一个争用期为检测到碰撞，则此次发送不会冲突。

采用二进制退避算法：最多重传16次，重传次数为k，从离散整数[0,1,2,4…2^k-1]随机选取一个数r

重传需要的退避时间为r*争用期

最小帧长（bit）：总线传播时延*数据传输速率*2，以太网规定64B，否则太短无法判断是否会冲突

​       

**CSMA/CA（载波侦听多路访问/碰撞避免）**

无线局域网使用的随机争用型介质访问控制方法，发送数据前先广播告诉其他结点在某段时间不要发送数据，对信道进行预约，以免出现碰撞

为什么要有这个协议：无线介质实现碰撞检测硬件花费过大；存在隐蔽站问题

适用于无线局域网，二进制退避算法

步骤：

- 发送端发送一个数据帧先广播一个RTS控制帧，包括源地址，目的地址，和此次通信的时间
- 若信道空闲，则接收端广播一个允许发送CTS控制帧，其他站点收到后在一段时间抑制发送
- 发送端发送数据帧
- 接收端接收到数据帧后，检验正确性，正确则响应ACK帧。

 

**轮询访问介质控制**

**令牌传递协议：**

在环形网络中，令牌在各结点间以固定次序交换，只有持有令牌的主机才能发送数据。

主要用在令牌环局域网中，不会产生碰撞

传输介质的物理拓扑不必是一个环，逻辑上环形拓扑

适合负载很高的广播通道







### **PPP点对点协议**

面向字节的广域网数据链路层协议，为点对点连接的多协议数据包提供标准方法。PPP具有身份验证，封装成帧，链路控制，网络控制等功能。

三个成部分：

链路控制协议LCP：建立并管理数据链路连接。

网络控制协议NCP：为不同的网络层协议建立和配置逻辑连接

一个将IP数据报封装到串行链路的方法

工作原理：

为了建立点对点链路上的通信连接，发送端PPP首先发送LCP帧，以配置和测试数据链路。

在LCP建立好数据链路并协调好所选设备之后，发送端PPP发送NCP帧，以选择和配置一个或多个网络层协议。

网络层协议配置好后，便可以将各网络层协议的数据包发送到数据链路上。配置好后的链路一直保持通信状态，直到LCP帧或NCP帧明确提示关闭链路，或者有其它的外部事件发生。

PPP协议注意点：

- 不提供纠错功能，只保证无差错接收
- 仅支持点对点
- 只支持全双工
- 两端可以运行不同的网络层协议
- 面向字节

 

### **HDLC高级数据链路控制协议**

ISO制定的面向比特的广域网数据链路层协议，数据报文可透明传输，并使用编号和确认机制来提供可靠传输。

- 全双工通信，较高的数据链路传输效率
- 所有帧使用CRC检验，顺序编号，可靠传输
- 传输控制与处理功能分离，较大灵活性

非平衡结构：主站控制整个链路工作

平衡结构：链路两端都是复合站，都能平等发起数据传输

主站：负责控制链路操作，发送命令帧

从站：受主站命令操作，发送响应帧

复合站：既有主站功能，又有从站功能

**数据操作方式**

正常响应方式：非平衡结构。主站向从站传输数据，收到主站允许从站才能响应传输。

异步平衡方式：平衡结构，每个复合站都能向其他复合站发送数据。

异步响应方式：非平衡机构。从站未受主站允许也能发送数据。

 

**HDLC与PPP的区别**

面向比特VS面向字节

PPP不使用序号和确认机制，只保证无差错接收。HDLC使用了编号和确认机制，可提供可靠传输

<img src="https://palepics.oss-cn-guangzhou.aliyuncs.com/img/image-20240321004612553.png" alt="image-20240321004612553" style="zoom: 67%;" />





### **数据链路层设备**

**网桥**

连接以太网，工作在链路层的MAC子层，处理对象是帧

优点：可以隔离碰撞域，可以互联不同的物理层，不同MAC子层和速率不同的局域网。

缺点：增大了时延，可能产生广播风暴。

透明网桥：按自学习算法填写转发表转发。（目前以太网最常用的网桥）

源路由网桥：把详细的路由信息放在帧的首部中，选择的是最佳路由。

**以太网交换机**

本质上是多端口网桥

特点：每个端口都直接与单台主机相连，能够同时连通许多对端口

**两种交换模式：**

直通式：接收帧后按照目的MAC地址立即转发，延迟小。

存储转发式：把接受的数据帧缓存检验正确性再处理。

网桥只有存储转发方式





### **VLAN虚拟局域网络**

将局域网内设备划分为与物理位置无关的逻辑组的技术，每个逻辑组具有某些共同的需求，且是单独的广播域。

交换机上不同的VLAN互不相同，需要借助路由器才能通信。

VLAN交换机既能隔离广播域，又能隔离冲突域。

<img src="https://palepics.oss-cn-guangzhou.aliyuncs.com/img/image-20240321004127687.png" alt="image-20240321004127687" style="zoom: 67%;" />

